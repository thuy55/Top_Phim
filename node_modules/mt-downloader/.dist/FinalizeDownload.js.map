{"version":3,"sources":["../src/FinalizeDownload.js"],"names":["FinalizeDownload","curry","FILE","fd$","meta$","ok$","noop$","partition","Boolean","Truncate","size$","pluck","truncate","combineLatest","take","Rename","params$","map","meta","mtdPath","path","rename","merge","flatMap","truncated$","renamed$"],"mappings":"AAAA;;;;AAIA;;;;;;;AAEA;;AACA;;AACA;;;;AACA;;;;AAEA;;;;;;;;;;;;AAYO,MAAMA,8CAAmB,gBAAEC,KAAF,CAAQ,CAAC,EAACC,IAAD,EAAD,EAAS,EAACC,GAAD,EAAMC,KAAN,EAAT,KAA0B;AAChE,QAAM,CAACC,GAAD,EAAMC,KAAN,IAAe,yBAAaF,KAAb,EAAoBG,SAApB,CAA8BC,OAA9B,CAArB;AACA,QAAMC,WAAW,CAAC,EAACP,IAAD,EAAOE,KAAP,EAAcD,GAAd,EAAD,KAAwB;AACvC,UAAMO,QAAQN,MAAMO,KAAN,CAAY,YAAZ,CAAd;AACA,WAAOT,KAAKU,QAAL,CAAc,eAAEC,aAAF,CAAgBV,GAAhB,EAAqBO,KAArB,EAA4BI,IAA5B,CAAiC,CAAjC,CAAd,CAAP;AACD,GAHD;AAIA,QAAMC,SAAS,CAAC,EAACb,IAAD,EAAOE,KAAP,EAAD,KAAmB;AAChC,UAAMY,UAAUZ,MAAMa,GAAN,CAAUC,QAAQ,CAACA,KAAKC,OAAN,EAAeD,KAAKE,IAApB,CAAlB,EAA6CN,IAA7C,CAAkD,CAAlD,CAAhB;AACA,WAAOZ,KAAKmB,MAAL,CAAYL,OAAZ,CAAP;AACD,GAHD;AAIA,SAAO,eAAEM,KAAF,CACL,gBAAI,EAAChB,KAAD,EAAJ,CADK,EAELD,IAAIkB,OAAJ,CAAY,MAAM;AAChB,UAAMC,aAAaf,SAAS,EAACP,IAAD,EAAOE,KAAP,EAAcD,GAAd,EAAT,CAAnB;AACA,UAAMsB,WAAWD,WAAWD,OAAX,CAAmB,MAAMR,OAAO,EAACb,IAAD,EAAOE,KAAP,EAAP,CAAzB,CAAjB;AACA,WAAO,gBAAI,EAACoB,UAAD,EAAaC,QAAb,EAAJ,CAAP;AACD,GAJD,CAFK,CAAP;AAQD,CAlB+B,CAAzB","file":"FinalizeDownload.js","sourcesContent":["/**\n * Created by tushar.mathur on 29/06/16.\n */\n\n'use strict'\n\nimport {mux} from 'muxer'\nimport {Observable as O} from 'rx'\nimport R from 'ramda'\nimport {IsCompleted$} from './Utils'\n\n/**\n * Removes the meta information and the `.mtd` extension from the file once the\n * download is successfully completed.\n * @function\n * @param {object} params - `{fd$, meta$}`\n * @param {external:Observable} params.fd$ - File descriptor Observable\n * @param {external:Observable} params.meta$ - Download meta information\n * @returns {external:Observable}\n * A {@link https://github.com/tusharmath/muxer multiplexed stream} containing ~\n * - `truncated$` - Fired when the meta data is removed.\n * - `renamed$` - Fired when the `.mtd` extension is removed.\n */\nexport const FinalizeDownload = R.curry(({FILE}, {fd$, meta$}) => {\n  const [ok$, noop$] = IsCompleted$(meta$).partition(Boolean)\n  const Truncate = ({FILE, meta$, fd$}) => {\n    const size$ = meta$.pluck('totalBytes')\n    return FILE.truncate(O.combineLatest(fd$, size$).take(1))\n  }\n  const Rename = ({FILE, meta$}) => {\n    const params$ = meta$.map(meta => [meta.mtdPath, meta.path]).take(1)\n    return FILE.rename(params$)\n  }\n  return O.merge(\n    mux({noop$}),\n    ok$.flatMap(() => {\n      const truncated$ = Truncate({FILE, meta$, fd$})\n      const renamed$ = truncated$.flatMap(() => Rename({FILE, meta$}))\n      return mux({truncated$, renamed$})\n    })\n  )\n})\n"]}